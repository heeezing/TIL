<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.board.dao.BoardMapper">

	<!-- 글 등록 -->
	<insert id="insertBoard" parameterType="boardVO">
		INSERT INTO spboard(
			board_num,
			title,
			content,
			ip,
			mem_num
			)
		VALUES(
			spboard_seq.nextval,
			#{title},
			#{content},
			#{ip},
			#{mem_num}
			)
	</insert>


	<!-- 게시판 목록 -->
	<sql id="boardSearch">
		<where>
			<if test="keyword != null and keyword != ''">
				<if test="keyfield == 1">
					b.title LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 2">
					m.id LIKE '%' || #{keyword} || '%' or 
					m.nick_name LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 3">
					b.content LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 4">
					b.title LIKE '%' || #{keyword} || '%' or 
					b.content LIKE '%' || #{keyword} || '%'
				</if>
			</if>
		</where>
	</sql>

	<sql id="boardOrder">
		<if test="order == 1">
			ORDER BY b.board_num DESC
		</if>
		<if test="order == 2">
			ORDER BY b.hit DESC
		</if>
		<if test="order == 3">
			ORDER BY fav_cnt DESC
		</if>
		<if test="order == 4">
			ORDER BY re_cnt DESC
		</if>
	</sql>

	<!-- 전체or검색 레코드 수 -->
	<select id="selectRowCount" parameterType="map" resultType="integer">
		SELECT COUNT(*) 
		FROM spboard b JOIN spmember m ON b.mem_num = m.mem_num
		<include refid="boardSearch"></include>
	</select>
	
	<!-- 전체or검색 목록 -->
	<select id="selectList" parameterType="map" resultType="boardVO">
		SELECT * 
		FROM (SELECT a.*, rownum rnum 
			  FROM (SELECT *
			  		FROM spboard b JOIN spmember m ON b.mem_num = m.mem_num 
			  		<include refid="boardSearch"></include>
			  		<include refid="boardOrder"></include>)a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	
</mapper>